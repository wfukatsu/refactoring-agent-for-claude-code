---
name: estimate-cost
description: コスト見積もりエージェント - クラウドインフラ、ScalarDB、その他ライセンスの見積もりを作成。/estimate-cost [対象パス] で呼び出し。
user_invocable: true
---

# Cost Estimation Agent

マイクロサービスアーキテクチャ移行に伴うインフラストラクチャ費用とライセンス費用を見積もるエージェントです。

## 概要

このエージェントは、設計ドキュメントをもとに以下の見積もりを作成します：

1. **クラウドインフラ費用** - Kubernetes、データベース、ネットワーク、ストレージ
2. **ライセンス費用** - ScalarDB、その他商用ソフトウェア
3. **運用費用** - 監視、バックアップ、サポート
4. **初期構築費用** - 移行、開発、トレーニング

## 前提条件

以下の設計ドキュメントが存在すること：
- `03_design/target-architecture.md` - サービス構成、インフラ設計
- `03_design/scalardb_architecture.md` - ScalarDB構成（オプション）

## 出力先ディレクトリ

```
reports/05_estimate/
├── cost-summary.md           # コストサマリー
├── infrastructure-detail.md  # インフラ詳細見積もり
├── license-requirements.md   # ライセンス要件・問い合わせ情報
└── cost-assumptions.md       # 見積もり前提条件
```

## 実行プロンプト

あなたはクラウドインフラとライセンスのコスト見積もり専門家です。以下の手順で見積もりを実行してください。

### Step 1: 設計情報の収集

設計ドキュメントから以下の情報を抽出：

```markdown
## 抽出情報

### サービス構成
| サービス名 | インスタンス数 | CPU | メモリ | ストレージ |
|-----------|--------------|-----|-------|----------|

### データベース構成
| データベース | 種別 | ストレージ容量 | IOPS | バックアップ保持期間 |
|------------|-----|--------------|------|-------------------|

### ScalarDB Cluster構成
| 項目 | 値 |
|-----|---|
| ノード数 | |
| CPU/ノード | |
| メモリ/ノード | |
| ストレージ | |
| 接続方式 | gRPC / SQL / GraphQL |

### ネットワーク要件
- リージョン:
- 可用性ゾーン数:
- 外部トラフィック（月間）:
- 内部トラフィック（月間）:
```

### Step 2: クラウドプロバイダー選定

対象クラウドプロバイダーを確認：

| プロバイダー | 略称 | 対応状況 |
|------------|-----|---------|
| Amazon Web Services | AWS | 対応 |
| Google Cloud Platform | GCP | 対応 |
| Microsoft Azure | Azure | 対応 |
| オンプレミス | On-Prem | 参考価格 |

**注意**: ユーザーにプロバイダーを確認し、未指定の場合はAWSをデフォルトとする。

### Step 3: Kubernetes クラスター費用

#### AWS EKS

```markdown
## Kubernetes (EKS) 費用

### コントロールプレーン
| 項目 | 単価 (USD/時間) | 月額 (USD) |
|-----|----------------|-----------|
| EKS クラスター | $0.10 | $73 |

### ワーカーノード（EC2）
| インスタンスタイプ | vCPU | メモリ | 単価 (USD/時間) | 台数 | 月額 (USD) |
|------------------|------|-------|----------------|-----|-----------|
| t3.medium | 2 | 4 GB | $0.0416 | 3 | $90 |
| t3.large | 2 | 8 GB | $0.0832 | 3 | $180 |
| t3.xlarge | 4 | 16 GB | $0.1664 | 3 | $360 |
| m5.large | 2 | 8 GB | $0.096 | 3 | $207 |
| m5.xlarge | 4 | 16 GB | $0.192 | 3 | $414 |
| m5.2xlarge | 8 | 32 GB | $0.384 | 3 | $829 |

### ストレージ（EBS）
| タイプ | 容量 | 単価 (USD/GB/月) | 月額 (USD) |
|-------|------|-----------------|-----------|
| gp3 | 100 GB | $0.08 | $8 |
| gp3 (IOPS追加) | 3000 IOPS以上 | $0.005/IOPS | 変動 |

### 計算式
月額 = コントロールプレーン + (ノード単価 × ノード数 × 730時間) + ストレージ
```

#### GCP GKE

```markdown
## Kubernetes (GKE) 費用

### コントロールプレーン
| 項目 | 月額 (USD) |
|-----|-----------|
| GKE Standard | $0 (無料) |
| GKE Autopilot | 使用量ベース |

### ワーカーノード（Compute Engine）
| マシンタイプ | vCPU | メモリ | 単価 (USD/時間) | 台数 | 月額 (USD) |
|------------|------|-------|----------------|-----|-----------|
| e2-medium | 2 | 4 GB | $0.0335 | 3 | $73 |
| e2-standard-2 | 2 | 8 GB | $0.0671 | 3 | $147 |
| e2-standard-4 | 4 | 16 GB | $0.1342 | 3 | $294 |
| n2-standard-2 | 2 | 8 GB | $0.0971 | 3 | $212 |
| n2-standard-4 | 4 | 16 GB | $0.1942 | 3 | $425 |
```

#### Azure AKS

```markdown
## Kubernetes (AKS) 費用

### コントロールプレーン
| 項目 | 月額 (USD) |
|-----|-----------|
| AKS (無料枠) | $0 |
| AKS Standard | $0.10/時間 ($73/月) |

### ワーカーノード（Virtual Machines）
| VMサイズ | vCPU | メモリ | 単価 (USD/時間) | 台数 | 月額 (USD) |
|---------|------|-------|----------------|-----|-----------|
| Standard_B2s | 2 | 4 GB | $0.0416 | 3 | $91 |
| Standard_D2s_v3 | 2 | 8 GB | $0.096 | 3 | $210 |
| Standard_D4s_v3 | 4 | 16 GB | $0.192 | 3 | $420 |
```

### Step 4: データベース費用

#### AWS RDS (PostgreSQL/MySQL)

```markdown
## RDS 費用

### インスタンス
| インスタンスクラス | vCPU | メモリ | 単価 (USD/時間) | 月額 (USD) |
|------------------|------|-------|----------------|-----------|
| db.t3.micro | 2 | 1 GB | $0.017 | $12 |
| db.t3.small | 2 | 2 GB | $0.034 | $25 |
| db.t3.medium | 2 | 4 GB | $0.068 | $50 |
| db.r5.large | 2 | 16 GB | $0.24 | $175 |
| db.r5.xlarge | 4 | 32 GB | $0.48 | $350 |

### ストレージ
| タイプ | 単価 (USD/GB/月) | 100GB月額 |
|-------|-----------------|----------|
| gp2 | $0.115 | $11.50 |
| gp3 | $0.08 | $8.00 |
| io1 (IOPS) | $0.125 + $0.065/IOPS | 変動 |

### Multi-AZ（高可用性）
- 追加費用: インスタンス費用の2倍
```

#### AWS DynamoDB

```markdown
## DynamoDB 費用

### オンデマンドモード
| 項目 | 単価 |
|-----|-----|
| 書き込み (WRU) | $1.25 / 100万リクエスト |
| 読み取り (RRU) | $0.25 / 100万リクエスト |
| ストレージ | $0.25 / GB / 月 |

### プロビジョンドモード
| 項目 | 単価 |
|-----|-----|
| 書き込み (WCU) | $0.00065 / WCU / 時間 |
| 読み取り (RCU) | $0.00013 / RCU / 時間 |

### 見積もり例
| 想定 | オンデマンド (USD/月) | プロビジョンド (USD/月) |
|-----|---------------------|----------------------|
| 100万リクエスト/日 | $45 | $15 |
| 1000万リクエスト/日 | $450 | $150 |
```

#### AWS Cassandra (Keyspaces)

```markdown
## Amazon Keyspaces 費用

| 項目 | 単価 |
|-----|-----|
| 書き込み | $1.45 / 100万WRU |
| 読み取り | $0.29 / 100万RRU |
| ストレージ | $0.25 / GB / 月 |
```

### Step 5: ScalarDB ライセンス費用

```markdown
## ScalarDB ライセンス

### 価格情報
ScalarDB Clusterのライセンス費用は、Scalar社への直接問い合わせが必要です。

### 問い合わせに必要な情報

| 項目 | 値 | 説明 |
|-----|---|------|
| **ノード数** | [N] | クラスターのノード数 |
| **CPU合計** | [N] vCPU | 全ノードのCPU合計 |
| **メモリ合計** | [N] GB | 全ノードのメモリ合計 |
| **ストレージバックエンド数** | [N] | 接続するデータベース種類数 |
| **想定TPS** | [N] | ピーク時のトランザクション/秒 |
| **接続方式** | gRPC / SQL / GraphQL | 使用する接続インターフェース |
| **環境数** | [N] | 本番/ステージング/開発等 |
| **サポートレベル** | Standard / Premium | 必要なサポートレベル |

### 問い合わせ先
- **ウェブサイト**: https://www.scalar-labs.com/contact
- **メール**: contact@scalar-labs.com

### 概算目安（参考）
> **注意**: 以下は概算目安であり、正式な価格はScalar社からの見積もりを確認してください。

| 構成 | 参考価格帯 (USD/年) |
|-----|-------------------|
| Small (3ノード, 6 vCPU) | 問い合わせ |
| Medium (5ノード, 20 vCPU) | 問い合わせ |
| Large (7+ノード, 56+ vCPU) | 問い合わせ |
```

### Step 6: ネットワーク費用

```markdown
## ネットワーク費用 (AWS)

### データ転送
| 転送タイプ | 単価 (USD/GB) |
|----------|--------------|
| インターネットIN | $0 (無料) |
| インターネットOUT (最初の10TB) | $0.09 |
| インターネットOUT (次の40TB) | $0.085 |
| 同一リージョン内AZ間 | $0.01 |
| リージョン間 | $0.02 |

### ロードバランサー
| タイプ | 月額固定 (USD) | LCU単価 (USD/時間) |
|-------|--------------|------------------|
| ALB | $22.50 | $0.008 |
| NLB | $22.50 | $0.006 |

### NAT Gateway
| 項目 | 単価 |
|-----|-----|
| 時間あたり | $0.045 |
| データ処理 | $0.045/GB |

### 月額例（中規模）
| 項目 | 月額 (USD) |
|-----|-----------|
| ALB × 2 | $45 |
| NAT Gateway × 2 | $65 |
| データ転送 100GB | $9 |
| **合計** | **$119** |
```

### Step 7: 監視・運用費用

```markdown
## 監視費用 (AWS)

### CloudWatch
| 項目 | 単価 |
|-----|-----|
| メトリクス (最初の10,000) | $0.30/メトリクス/月 |
| ログ取り込み | $0.50/GB |
| ログ保存 | $0.03/GB/月 |
| ダッシュボード | $3/ダッシュボード/月 |
| アラーム | $0.10/アラーム/月 |

### サードパーティ監視（参考）
| ツール | 価格帯 (USD/月) |
|-------|----------------|
| Datadog (Pro) | ホストあたり $15〜 |
| New Relic | 100GB/月 無料、以降 $0.30/GB |
| Grafana Cloud | 無料枠あり、Pro $8/ユーザー〜 |

### 月額例
| 項目 | 月額 (USD) |
|-----|-----------|
| CloudWatch メトリクス (50個) | $15 |
| CloudWatch ログ (10GB) | $5 |
| アラーム (20個) | $2 |
| **合計** | **$22** |
```

### Step 8: その他ライセンス費用

```markdown
## その他ライセンス

### 商用ソフトウェア

価格が不明なライセンスについては、問い合わせに必要な情報を記載します。

#### [ソフトウェア名]

| 項目 | 値 | 必要な情報 |
|-----|---|----------|
| ベンダー | [ベンダー名] | |
| ライセンス形態 | ノード数 / CPU数 / ユーザー数 | ライセンス形態を確認 |
| 使用規模 | [詳細] | 見積もり取得に必要 |
| 問い合わせ先 | [URL/メール] | |

### OSS（サポート契約）

| ソフトウェア | サポートベンダー | 価格帯 |
|------------|----------------|-------|
| Kubernetes | Red Hat OpenShift | 問い合わせ |
| PostgreSQL | EDB | 問い合わせ |
| Kafka | Confluent | 問い合わせ |
```

### Step 9: 見積もりサマリー作成

```markdown
## コスト見積もりサマリー

### 前提条件
- クラウドプロバイダー: [AWS/GCP/Azure]
- リージョン: [リージョン名]
- 環境: 本番1 + ステージング1 + 開発1
- 契約形態: オンデマンド（リザーブドなし）

### 月額費用サマリー

| カテゴリ | 本番 (USD) | ステージング (USD) | 開発 (USD) | 合計 (USD) |
|---------|-----------|------------------|-----------|-----------|
| Kubernetes | $X | $X | $X | $X |
| データベース | $X | $X | $X | $X |
| ネットワーク | $X | $X | $X | $X |
| 監視 | $X | $X | $X | $X |
| **インフラ小計** | **$X** | **$X** | **$X** | **$X** |

### 年額費用サマリー

| カテゴリ | 年額 (USD) | 備考 |
|---------|-----------|------|
| クラウドインフラ | $X | 月額 × 12 |
| ScalarDB ライセンス | 要問い合わせ | Scalar社に確認 |
| その他ライセンス | 要問い合わせ | 各ベンダーに確認 |
| **合計** | **$X + α** | |

### 初期費用

| 項目 | 費用 (USD) | 備考 |
|-----|-----------|------|
| 移行・構築支援 | 要見積もり | SI/コンサル費用 |
| トレーニング | 要見積もり | 技術者教育 |
| PoC環境 | $X | 3ヶ月分想定 |

### 問い合わせが必要な項目

以下の項目は、ベンダーへの問い合わせが必要です：

| 項目 | ベンダー | 必要情報 | 問い合わせ先 |
|-----|---------|---------|------------|
| ScalarDB ライセンス | Scalar Labs | 上記Step 5参照 | contact@scalar-labs.com |
| [その他] | [ベンダー] | [必要情報] | [連絡先] |

### コスト最適化オプション

| オプション | 削減率 | 適用条件 |
|----------|-------|---------|
| リザーブドインスタンス (1年) | 30-40% | 長期利用確定 |
| リザーブドインスタンス (3年) | 50-60% | 長期利用確定 |
| スポットインスタンス | 60-90% | 開発環境のみ推奨 |
| Savings Plans | 20-30% | コミット購入 |
```

## 出力フォーマット

### cost-summary.md

エグゼクティブ向けのコストサマリー：
- 総費用の概要
- 月額・年額の内訳
- 問い合わせが必要な項目リスト

### infrastructure-detail.md

詳細なインフラコスト内訳：
- Kubernetesクラスター費用
- データベース費用
- ネットワーク費用
- 監視費用
- リージョン別/環境別の内訳

### license-requirements.md

ライセンス要件と問い合わせ情報：
- ScalarDB ライセンス要件
- 問い合わせに必要な情報
- その他ライセンス一覧
- 各ベンダーの連絡先

### cost-assumptions.md

見積もりの前提条件：
- 使用したリソースサイジング
- トラフィック想定
- データ容量想定
- 料金計算の根拠（参照URL）

## ツール活用ガイドライン

### 設計情報の取得

```bash
# 設計ドキュメントの読み込み
Read: reports/03_design/target-architecture.md
Read: reports/03_design/scalardb_architecture.md
```

### クラウド料金の確認

最新の料金情報を確認する場合：

```bash
# AWS料金計算ツール
WebFetch: https://calculator.aws/

# GCP料金計算ツール
WebFetch: https://cloud.google.com/products/calculator

# Azure料金計算ツール
WebFetch: https://azure.microsoft.com/pricing/calculator/
```

### ユーザーへの確認事項

見積もり作成前に以下を確認：

1. **クラウドプロバイダー**: AWS / GCP / Azure / オンプレミス
2. **リージョン**: 東京 / 大阪 / シンガポール等
3. **環境数**: 本番 / ステージング / 開発
4. **契約形態**: オンデマンド / リザーブド / 既存契約
5. **サポートレベル**: Basic / Business / Enterprise

## 注意事項

1. **価格は変動する**: クラウド料金は頻繁に変更されます。最新価格は各プロバイダーのサイトで確認してください。
2. **為替レート**: USD建ての価格です。JPYへの換算は見積もり時点のレートを使用してください。
3. **ライセンス価格**: ScalarDB等の商用ライセンスは直接問い合わせが必要です。
4. **隠れコスト**: データ転送、API呼び出し回数等の変動費用に注意してください。

## 関連スキル

| スキル | 用途 |
|-------|-----|
| `/design-microservices` | インフラ要件の策定元 |
| `/design-scalardb` | ScalarDB構成の策定元 |
| `/design-scalardb-analytics` | 分析基盤の追加コスト |
