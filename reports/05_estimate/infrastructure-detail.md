# インフラストラクチャ詳細見積もり

## 1. 概要

| 項目 | 値 |
|------|---|
| **クラウドプロバイダー** | AWS |
| **リージョン** | ap-northeast-1 (東京) |
| **可用性ゾーン** | 3 AZ (ap-northeast-1a, 1c, 1d) |
| **見積もり基準日** | 2025-01-12 |
| **価格タイプ** | オンデマンド（リザーブドなし） |

---

## 2. Kubernetes (Amazon EKS)

### 2.1 本番環境

#### EKS Control Plane

| 項目 | 単価 (USD/時間) | 時間/月 | 月額 (USD) |
|------|----------------|--------|-----------|
| EKS Cluster | $0.10 | 730 | $73 |

#### Worker Nodes (アプリケーション用)

| インスタンスタイプ | vCPU | メモリ | 単価 (USD/時間) | 台数 | 月額 (USD) |
|------------------|------|-------|----------------|-----|-----------|
| m5.xlarge | 4 | 16 GB | $0.192 | 6 | $840.96 |

**サービス配置計画:**
- Identity Service: 3 replicas × 0.5 vCPU, 512MB
- Audit Service: 3 replicas × 1 vCPU, 1GB
- File Service: 3 replicas × 0.5 vCPU, 512MB
- Event Service: 3 replicas × 0.5 vCPU, 512MB
- Verification Service: 3 replicas × 0.5 vCPU, 512MB
- BOX Integration Service: 3 replicas × 0.5 vCPU, 512MB
- API Gateway (Kong): 2 replicas × 1 vCPU, 1GB

#### ScalarDB Cluster Nodes

| インスタンスタイプ | vCPU | メモリ | 単価 (USD/時間) | 台数 | 月額 (USD) |
|------------------|------|-------|----------------|-----|-----------|
| m5.xlarge | 4 | 16 GB | $0.192 | 3 | $420.48 |

#### ストレージ (EBS)

| タイプ | 容量 | 単価 (USD/GB/月) | 月額 (USD) |
|-------|------|-----------------|-----------|
| gp3 (Worker) | 100GB × 6 | $0.08 | $48 |
| gp3 (ScalarDB) | 100GB × 3 | $0.08 | $24 |

**本番EKS合計: $1,406/月**

---

### 2.2 ステージング環境

| リソース | スペック | 台数 | 月額 (USD) |
|---------|---------|-----|-----------|
| EKS Control Plane | - | 1 | $73 |
| Worker Nodes (m5.large) | 2 vCPU, 8GB | 3 | $210 |
| ScalarDB Nodes (m5.large) | 2 vCPU, 8GB | 2 | $140 |
| EBS (gp3) | 50GB × 5 | 250GB | $20 |

**ステージングEKS合計: $443/月**

---

### 2.3 開発環境

| リソース | スペック | 台数 | 月額 (USD) |
|---------|---------|-----|-----------|
| EKS Control Plane | - | 1 | $73 |
| Worker Nodes (t3.large) | 2 vCPU, 8GB | 2 | $120 |
| ScalarDB Nodes (t3.large) | 2 vCPU, 8GB | 1 | $60 |
| EBS (gp3) | 50GB × 3 | 150GB | $12 |

**開発EKS合計: $265/月**

---

## 3. データベース

### 3.1 Amazon Aurora PostgreSQL

#### 本番環境

| 構成 | インスタンスクラス | vCPU | メモリ | 月額 (USD) |
|-----|------------------|------|-------|-----------|
| Writer | db.r5.large | 2 | 16 GB | $212 |
| Reader 1 | db.r5.large | 2 | 16 GB | $212 |
| Reader 2 | db.r5.large | 2 | 16 GB | $212 |

| ストレージ・I/O | 容量/数量 | 単価 | 月額 (USD) |
|---------------|----------|------|-----------|
| Aurora Storage | 200GB | $0.12/GB | $24 |
| I/O リクエスト | 100M/月 | $0.24/100万 | $24 |
| バックアップ | 200GB | $0.023/GB | $5 |

**本番Aurora合計: $689/月**

#### ステージング環境

| 構成 | インスタンスクラス | 月額 (USD) |
|-----|------------------|-----------|
| Writer | db.t3.medium | $68 |
| Reader | db.t3.medium | $68 |
| Storage (100GB) + I/O | - | $20 |

**ステージングAurora合計: $156/月**

#### 開発環境

| 構成 | インスタンスクラス | 月額 (USD) |
|-----|------------------|-----------|
| Serverless v2 | 0.5-2 ACU | $45 |
| Storage (50GB) + I/O | - | $10 |

**開発Aurora合計: $55/月**

> **Aurora PostgreSQLの利点:**
> - 自動フェイルオーバー (30秒以内)
> - ストレージ自動拡張 (最大128TB)
> - 3AZにまたがる6コピーのレプリケーション
> - PostgreSQL互換 (既存コード変更最小)

---

### 3.2 Amazon DynamoDB

#### 本番環境（オンデマンドキャパシティ）

| 項目 | 想定利用量 | 単価 | 月額 (USD) |
|------|----------|------|-----------|
| 書き込み | 10M WRU/月 | $1.4269/100万 | $14 |
| 読み取り | 30M RRU/月 | $0.285/100万 | $9 |
| ストレージ | 60GB | $0.285/GB | $17 |
| PITR (ポイントインタイムリカバリ) | 60GB | $0.228/GB | $14 |

**本番DynamoDB合計: $54/月**

#### ステージング/開発

| 環境 | キャパシティモード | 月額 (USD) |
|-----|------------------|-----------|
| ステージング | オンデマンド | $20 |
| 開発 | オンデマンド | $10 |

> **DynamoDBの利点:**
> - フルマネージド (運用負荷ゼロ)
> - 自動スケーリング
> - 99.999% 可用性 (グローバルテーブル)
> - ミリ秒単位のレイテンシ
> - Cassandra比 **約85%のコスト削減**

---

### 3.3 Amazon ElastiCache (Redis)

#### 本番環境

| 構成 | ノードタイプ | ノード数 | 月額 (USD) |
|-----|------------|--------|-----------|
| Primary | cache.r5.large | 1 | $100 |
| Replica | cache.r5.large | 1 | $100 |

**本番Redis合計: $200/月**

#### ステージング/開発

| 環境 | ノードタイプ | 月額 (USD) |
|-----|------------|-----------|
| ステージング | cache.t3.medium | $40 |
| 開発 | cache.t3.small | $20 |

---

## 4. メッセージング (Amazon MQ / MSK)

### 4.1 Amazon MQ (RabbitMQ)

#### 本番環境

| 構成 | インスタンス | 月額 (USD) |
|-----|------------|-----------|
| Active-Standby | mq.m5.large × 2 | $240 |
| ストレージ | 100GB | $10 |

**本番MQ合計: $250/月**

#### ステージング/開発

| 環境 | インスタンス | 月額 (USD) |
|-----|------------|-----------|
| ステージング | mq.t3.micro × 1 | $18 |
| 開発 | mq.t3.micro × 1 | $18 |

---

## 5. ネットワーク

### 5.1 ロードバランサー

| タイプ | 用途 | 台数 | 月額固定 (USD) |
|-------|-----|-----|--------------|
| ALB | External API | 1 | $22.50 |
| ALB | Internal Services | 1 | $22.50 |
| NLB | ScalarDB Cluster | 1 | $22.50 |

**ロードバランサー合計: $67.50/月**

### 5.2 NAT Gateway

| リソース | 台数 | 月額 (USD) |
|---------|-----|-----------|
| NAT Gateway | 2 (Multi-AZ) | $65 |
| データ処理 (100GB想定) | - | $4.50 |

**NAT合計: $69.50/月**

### 5.3 データ転送

| 転送タイプ | 容量/月 | 単価 (USD/GB) | 月額 (USD) |
|----------|--------|--------------|-----------|
| インターネットOUT | 100GB | $0.09 | $9 |
| AZ間転送 | 500GB | $0.01 | $5 |

**データ転送合計: $14/月**

### 5.4 Route 53

| 項目 | 月額 (USD) |
|------|-----------|
| ホストゾーン | $0.50 |
| クエリ (100万) | $0.40 |

**Route 53合計: $0.90/月**

---

## 6. 監視・ログ

### 6.1 Amazon CloudWatch

| 項目 | 数量 | 単価 | 月額 (USD) |
|------|------|------|-----------|
| カスタムメトリクス | 100 | $0.30/メトリクス | $30 |
| ログ取り込み | 50GB | $0.50/GB | $25 |
| ログ保存 | 100GB | $0.03/GB | $3 |
| ダッシュボード | 5 | $3/ダッシュボード | $15 |
| アラーム | 50 | $0.10/アラーム | $5 |

**CloudWatch合計: $78/月**

### 6.2 Prometheus/Grafana (Self-hosted)

| リソース | スペック | 月額 (USD) |
|---------|---------|-----------|
| Prometheus (EC2 t3.large) | 2 vCPU, 8GB | $60 |
| Grafana (EC2 t3.small) | 2 vCPU, 2GB | $15 |
| EBS Storage | 200GB gp3 | $16 |

**Prometheus/Grafana合計: $91/月**

---

## 7. 環境別コスト一覧

### 7.1 本番環境

| カテゴリ | 月額 (USD) |
|---------|-----------|
| EKS (Control + Workers + ScalarDB) | $1,406 |
| Aurora PostgreSQL | $689 |
| DynamoDB | $54 |
| Redis | $200 |
| MQ (RabbitMQ) | $250 |
| ネットワーク | $152 |
| 監視・ログ | $169 |
| **本番合計** | **$2,920** |

### 7.2 ステージング環境

| カテゴリ | 月額 (USD) |
|---------|-----------|
| EKS | $443 |
| Aurora PostgreSQL | $156 |
| DynamoDB | $20 |
| Redis | $40 |
| MQ (RabbitMQ) | $18 |
| ネットワーク | $76 |
| 監視・ログ | $85 |
| **ステージング合計** | **$838** |

### 7.3 開発環境

| カテゴリ | 月額 (USD) |
|---------|-----------|
| EKS | $265 |
| Aurora PostgreSQL | $55 |
| DynamoDB | $10 |
| Redis | $20 |
| MQ (RabbitMQ) | $18 |
| ネットワーク | $38 |
| 監視・ログ | $42 |
| **開発合計** | **$448** |

---

## 8. 総合計

| 環境 | 月額 (USD) | 年額 (USD) | 年額 (JPY) |
|-----|-----------|-----------|-----------|
| 本番 | $2,920 | $35,040 | ¥5,256,000 |
| ステージング | $838 | $10,056 | ¥1,508,400 |
| 開発 | $448 | $5,376 | ¥806,400 |
| **合計** | **$4,206** | **$50,472** | **¥7,570,800** |

> **旧構成 (RDS + Cassandra) との比較:**
> - 旧月額: $4,560 → 新月額: $4,206 (**$354/月 削減**)
> - 年間削減額: **$4,248 (¥637,200)**
> - 削減率: **約7.8%**

---

## 9. コスト削減オプション

### 9.1 リザーブドインスタンス (1年)

| リソース | オンデマンド | リザーブド | 削減額/年 |
|---------|------------|----------|----------|
| EC2 (m5.xlarge × 9) | $12,528 | $8,770 | $3,758 |
| Aurora (db.r5.large × 3) | $7,632 | $5,342 | $2,290 |
| ElastiCache | $2,400 | $1,680 | $720 |
| **合計** | **$22,560** | **$15,792** | **$6,768** |

> **Note:** DynamoDBはオンデマンドのためリザーブド対象外。Provisioned Capacityに変更すれば追加削減可能。

### 9.2 Savings Plans (Compute)

| コミット額 | 削減率 | 年間削減額 |
|----------|-------|----------|
| $1,000/月 | 20% | $2,400 |
| $2,000/月 | 25% | $6,000 |
| $3,000/月 | 30% | $10,800 |

### 9.3 開発環境スポットインスタンス

| リソース | オンデマンド | スポット | 削減額/年 |
|---------|------------|--------|----------|
| Worker Nodes | $2,160 | $648 | $1,512 |

---

*Generated: 2025-01-13*
*Pricing Source: AWS Tokyo Region (ap-northeast-1)*
*Database: Aurora PostgreSQL, DynamoDB (マネージドサービス構成)*
