# 見積もり前提条件

## 1. 基本前提

### 1.1 一般条件

| 項目 | 前提値 | 備考 |
|------|-------|------|
| **見積もり基準日** | 2025-01-13 | |
| **為替レート** | $1 = ¥150 | 見積もり時点の概算レート |
| **価格タイプ** | オンデマンド | リザーブドインスタンス未適用 |
| **契約期間** | 1年 | |
| **税金** | 含まず | 消費税別途 |
| **データベース構成** | Aurora PostgreSQL + DynamoDB | フルマネージド |

### 1.2 クラウド環境

| 項目 | 前提値 | 備考 |
|------|-------|------|
| **クラウドプロバイダー** | AWS | |
| **リージョン** | ap-northeast-1 (東京) | |
| **可用性ゾーン** | 3 AZ | 高可用性構成 |
| **環境数** | 3 | 本番、ステージング、開発 |

---

## 2. システム規模前提

### 2.1 ユーザー規模

| 項目 | 前提値 | 根拠 |
|------|-------|------|
| 同時接続ユーザー数 | 500 | ピーク時想定 |
| 登録ユーザー数 | 5,000 | 年間想定 |
| 外部監査者数 | 200 | |
| 組織数 | 10 | マルチテナント |

### 2.2 データ規模

| 項目 | 前提値 | 根拠 |
|------|-------|------|
| 監査セット数 | 10,000 | 年間想定 |
| 監査アイテム数 | 500,000 | 年間想定 |
| イベントログ数 | 10,000,000 | 月間想定 |
| データ増加率 | 20%/年 | |

### 2.3 トラフィック規模

| 項目 | 前提値 | 根拠 |
|------|-------|------|
| API呼び出し数 | 100,000/日 | 平均 |
| ピーク時API呼び出し数 | 500,000/日 | 月末・四半期末 |
| データ転送量 (外部) | 100 GB/月 | |
| データ転送量 (内部) | 500 GB/月 | |

---

## 3. インフラサイジング根拠

### 3.1 Kubernetes Worker Nodes

| サービス | レプリカ数 | CPU要求 | メモリ要求 | 合計CPU | 合計メモリ |
|---------|----------|--------|----------|--------|----------|
| Identity Service | 3 | 500m | 512Mi | 1.5 | 1.5Gi |
| Audit Service | 3 | 1000m | 1Gi | 3 | 3Gi |
| File Service | 3 | 500m | 512Mi | 1.5 | 1.5Gi |
| Event Service | 3 | 500m | 512Mi | 1.5 | 1.5Gi |
| Verification Service | 3 | 500m | 512Mi | 1.5 | 1.5Gi |
| BOX Integration | 3 | 500m | 512Mi | 1.5 | 1.5Gi |
| Kong Gateway | 2 | 1000m | 1Gi | 2 | 2Gi |
| **合計** | | | | **12.5 vCPU** | **12.5 Gi** |

**サイジング計算:**
- 必要リソース: 12.5 vCPU, 12.5 GB
- オーバーヘッド (システム + バッファ): 50%
- 実効必要リソース: 18.75 vCPU, 18.75 GB
- m5.xlarge (4 vCPU, 16 GB) × 6 = 24 vCPU, 96 GB → **十分な余裕**

### 3.2 ScalarDB Cluster Nodes

| 項目 | 前提値 | 根拠 |
|------|-------|------|
| ノード数 | 3 | 高可用性 + 分散処理 |
| CPU/ノード | 4 vCPU | 公式推奨 + 想定TPS |
| メモリ/ノード | 16 GB | 公式推奨 |
| ストレージ/ノード | 100 GB | ログ + 一時データ |

### 3.3 Aurora PostgreSQL

| 項目 | 前提値 | 根拠 |
|------|-------|------|
| インスタンスクラス | db.r5.large | メモリ最適化 |
| 構成 | 1 Writer + 2 Reader | 高可用性 + 読み取りスケール |
| ストレージ | 200 GB (自動拡張) | 初期 + 1年分の増加 |
| I/O リクエスト | 100M/月 | 想定ワークロード |

**Aurora PostgreSQLの利点:**
- 自動フェイルオーバー (30秒以内)
- ストレージ自動拡張 (最大128TB)
- 3AZにまたがる6コピーの自動レプリケーション
- 継続的バックアップ (S3)
- PostgreSQL互換 (既存コード変更最小)

**データ容量計算:**
- Users: 5,000 × 1KB = 5 MB
- AuditSets: 10,000 × 2KB = 20 MB
- AuditSetItems: 500,000 × 1KB = 500 MB
- その他メタデータ: 100 MB
- インデックス・オーバーヘッド: 3x
- **合計: 約 2 GB/年** → 200 GB は十分な余裕

### 3.4 DynamoDB

| 項目 | 前提値 | 根拠 |
|------|-------|------|
| キャパシティモード | オンデマンド | 変動ワークロード対応 |
| 書き込みリクエスト | 10M WRU/月 | イベントログ書き込み |
| 読み取りリクエスト | 30M RRU/月 | 読み取り比率 3:1 |
| ストレージ | 60 GB (年間) | イベントログ保持 |

**DynamoDBの利点:**
- フルマネージド (運用負荷ゼロ)
- 自動スケーリング
- 99.999% 可用性
- ミリ秒単位のレイテンシ
- PITR (ポイントインタイムリカバリ) 対応

**データ容量計算:**
- イベントログ: 10,000,000/月 × 500B = 5 GB/月
- 保持期間: 12ヶ月
- **合計: 5 GB × 12 = 60 GB/年**
- DynamoDB自動スケーリングで対応

### 3.5 Redis (ElastiCache)

| 項目 | 前提値 | 根拠 |
|------|-------|------|
| ノードタイプ | cache.r5.large | セッション + キャッシュ |
| 構成 | 1 Primary + 1 Replica | 高可用性 |
| メモリ | 13 GB/ノード | |

**キャッシュ容量計算:**
- セッション: 5,000 × 4KB = 20 MB
- ユーザーキャッシュ: 5,000 × 2KB = 10 MB
- APIレスポンスキャッシュ: 500 MB
- **合計: 約 530 MB** → 13 GB は十分な余裕

---

## 4. 性能前提

### 4.1 トランザクション性能

| 指標 | 前提値 | 根拠 |
|------|-------|------|
| 想定TPS (平均) | 100 | 日常運用 |
| 想定TPS (ピーク) | 1,000 | 月末・四半期末 |
| レイテンシ P50 | < 50ms | 目標値 |
| レイテンシ P99 | < 200ms | 目標値 |

### 4.2 可用性

| 指標 | 前提値 |
|------|-------|
| 可用性目標 | 99.9% |
| 月間許容ダウンタイム | 43分 |
| RTO (目標復旧時間) | 60秒 |
| RPO (目標復旧地点) | 0 (同期レプリケーション) |

---

## 5. 運用前提

### 5.1 監視・ログ

| 項目 | 前提値 |
|------|-------|
| カスタムメトリクス数 | 100 |
| ログ取り込み量 | 50 GB/月 |
| ログ保持期間 | 90日 |
| アラート数 | 50 |

### 5.2 バックアップ

| 項目 | 前提値 |
|------|-------|
| RDS バックアップ保持 | 30日 |
| Cassandra スナップショット保持 | 14日 |
| Coordinator バックアップ頻度 | 1時間毎 |

---

## 6. 除外事項

以下の項目は本見積もりに**含まれていません**。

### 6.1 費用として除外

| 項目 | 理由 |
|------|------|
| 既存システムの廃止費用 | 別途見積もり |
| データ移行費用 | 工数ベースで別途算出 |
| 開発・構築人件費 | SI費用として別途 |
| トレーニング費用 | 別途見積もり |
| ドキュメント作成費用 | 別途見積もり |
| 予備費 | 通常10-20%を別途計上推奨 |
| 消費税 | 別途加算 |

### 6.2 機能として除外

| 項目 | 理由 |
|------|------|
| DR (災害復旧) 環境 | 別リージョン構成は別途 |
| CDN (CloudFront) | 現時点では不要と想定 |
| WAF | 要件次第で追加 |
| Direct Connect | 専用線は別途 |

---

## 7. リスク要因と影響

### 7.1 コスト上振れリスク

| リスク要因 | 影響度 | 対策 |
|----------|-------|------|
| トラフィック急増 | +30% | オートスケーリング設定、上限アラート |
| データ量増加 | +20% | ストレージ監視、ライフサイクルポリシー |
| 為替変動 | ±10% | 円建て契約検討、予算バッファ |
| AWS値上げ | +5% | Savings Plans、リザーブド検討 |

### 7.2 軽減策

| 対策 | 期待削減率 |
|------|----------|
| 1年リザーブドインスタンス | 30-40% |
| 3年リザーブドインスタンス | 50-60% |
| Savings Plans | 20-30% |
| スポットインスタンス (開発環境) | 60-90% |

---

## 8. 価格参照元

### 8.1 AWS公式価格ページ

| サービス | URL |
|---------|-----|
| EC2 | https://aws.amazon.com/ec2/pricing/on-demand/ |
| EKS | https://aws.amazon.com/eks/pricing/ |
| Aurora PostgreSQL | https://aws.amazon.com/rds/aurora/pricing/ |
| DynamoDB | https://aws.amazon.com/dynamodb/pricing/ |
| ElastiCache | https://aws.amazon.com/elasticache/pricing/ |
| MQ | https://aws.amazon.com/amazon-mq/pricing/ |

### 8.2 価格計算ツール

| ツール | URL |
|-------|-----|
| AWS Pricing Calculator | https://calculator.aws/ |

---

## 9. 改訂履歴

| 版 | 日付 | 変更内容 |
|---|------|---------|
| 1.0 | 2025-01-12 | 初版作成 |
| 1.1 | 2025-01-13 | Aurora PostgreSQL + DynamoDB構成に変更 |

---

*Generated: 2025-01-13*
